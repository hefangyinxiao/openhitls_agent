# 中华人民共和国国家标准

GB/T 17964—2021

代替GB/T17964—2008

# 信息安全技术分组密码算法的工作模式

Information security technology—Modes of operation for a block cipher

# 目次

前言 Ⅲ1 范围 12 规范性引用文件 13 术语和定义 14 符号和缩略语 34.1 符号 34.2 缩略语 45 电码本工作模式 45.1 变量定义 45.2 ECB的加密方式描述 55.3 ECB的解密方式描述 56 密文分组链接工作模式 56.1 变量定义 56.2 CBC的加密方式描述 66.3 CBC的解密方式描述 67 密文反馈工作模式 77.1 变量定义 77.2 CFB的加密方式描述 77.3 CFB的解密方式描述 88 输出反馈工作模式 88.1 变量定义 88.2 OFB的加密方式描述 98.3 OFB的解密方式描述 99 计数器工作模式 109.1 变量定义 109.2 CTR的加密方式描述 109.3 CTR的解密方式描述 1110 带密文挪用的XEX可调分组密码工作模式 1110.1 变量定义 1110.2 XTS的加密方式描述 1210.2.1 明文长度满足整数倍分组长度 1210.2.2 明文长度不满足整数倍分组长度 1210.3 XTS的解密方式描述 1310.3.1 密文长度满足整数倍分组长度 1310.3.2 密文长度不满足整数倍分组长度 13

11 带泛杂凑函数的计数器工作模式 1411.1 变量定义 1411.2 HCTR 的加密方式描述 1511.3 HCTR 的解密方式描述 1512 分组链接工作模式 1612.1 变量定义 1612.2 BC 的加密方式描述 1612.3 BC 的解密方式描述 1713 带非线性函数的输出反馈工作模式 1713.1 变量定义 1713.2 OFBNLF 的加密方式描述 1813.3 OFBNLF 的解密方式描述 18附录 A（资料性） 工作模式的性质 19附录 B（资料性） 工作模式示例 27附录 C（资料性） 填充方法示例 35参考文献 36

# 前言

本文件按照GB/T1.1—2020《标准化工作导则第1部分：标准化文件的结构和起草规则》的规定起草。

本文件代替GB/T17964—2008《信息安全技术分组密码算法的工作模式》，与GB/T17964—2008相比，除了结构调整和编辑性改动外，主要技术变化如下：

a）删除了“分组密码”等常见术语，增加了“XEX结构”等多个术语（见第3章，2008年版的3.1）；b）删除了“位阵列表达式”等多个定义（见2008年版的3.2）；c）增加了bit(S，i)等多个符号（见4.1）；d）增加了"HCTR"“XTS"等缩略语（见4.2）；e）增加了ECB工作模式加密算法和解密算法的示意图（见第5章）；f）删除了7.1和8.1，将相关参数定义增加到4.1符号中（见2008年版的第7章、第8章）；g）将第10章“分组链接(BC)模式”调整到新增加的第12章，增加了“带密文挪用的XEX可调分组密码工作模式”为第10章（见第10章、第12章，2008年版的第10章）；h）将第11章“带非线性函数的输出反馈（OFBNLF）工作模式”调整到新增加的第13章，增加了“带泛杂凑函数的计数器工作模式”为第11章（见第11章、第13章，2008年版的第11章）；i）更改了规范性附录A为资料性附录A（见附录A，2008年版的附录A）；j）更改了密文窃取的具体方法，增加了示意图，并将“密文窃取”更名为“密文挪用”（见附录A，2008年版的附录A）；k）增加了XTS工作模式的性质和HCTR工作模式的性质（见附录A）；l）更改了产生工作模式示例的分组密码为SM4算法（见附录B，2008年版的附录B）；m）增加了XTS工作模式的示例和HCTR工作模式的示例（见附录B）；n）增加了资料性附录C，列举了三种常见的填充方法，并给出了举例（见附录C）。请注意本文件的某些内容可能涉及专利。本文件的发布机构不承担识别专利的责任。

本文件由全国信息安全标准化技术委员会（SAC/TC260）提出并归口。

本文件起草单位：成都卫士通信息产业股份有限公司、中国科学院软件研究所、中国科学院数据与通信保护研究教育中心、国家密码管理局商用密码检测中心、格尔软件股份有限公司、西安西电捷通无线网络通信股份有限公司、上海信息安全工程技术研究中心。

本文件主要起草人：张立廷、眭晗、涂彬彬、李世敏、罗俊、王鹏、毛颖颖、邵强、张国强、徐明翼。

本文件及其所代替文件的历次版本发布情况为：

2000年首次发布为GB/T17964—2000；2008年第一次修订；本次为第二次修订。

# 信息安全技术分组密码算法的工作模式

# 1范围

1 范围本文件描述了九种分组密码算法的工作模式，给出了参数和方法。本文件适用于指导分组密码算法在加解密数据时的使用。本文件描述的工作模式仅适用于保护数据的机密性，不适用于保护数据的完整性。

# 2规范性引用文件

下列文件中的内容通过文中的规范性引用而构成本文件必不可少的条款。其中，注日期的引用文件，仅该日期对应的版本适用于本文件；不注日期的引用文件，其最新版本(包括所有的修改单)适用于本文件。

GB/T25069—2010 信息安全技术术语GM/Z4001—2013 密码术语

# 3术语和定义

3 术语和定义GB/T25069—2010和GM/Z4001—2013界定的以及下列术语和定义适用于本文件。

3.1

# 分组密码算法工作模式 block cipher operation mode

分组密码算法的使用方式，主要包括电码本工作模式、密文分组链接工作模式、密文反馈工作模式、输出反馈工作模式、计数器工作模式、带密文挪用的XEX可调分组密码工作模式、带泛杂凑函数的计数器工作模式、分组链接工作模式、带非线性函数的输出反馈工作模式等。

[来源：GM/Z4001—2013，2.26，有修改]

3.2

# 电码本工作模式electronic codebook(ECB)operation mode

分组密码算法的一种工作模式，其特征是将明文分组直接作为算法的输入，对应的输出作为密文分组。

[来源：GM/Z4001—2013，2.10]

3.3

# 密文分组链接工作模式 cipher block chaining(CBC)operation mode

分组密码算法的一种工作模式，其特征是将当前的明文分组与前一密文分组进行异或运算后再进行加密得到当前的密文分组。

[来源：GM/Z4001—2013，2.62]

3.4

# 密文反馈工作模式 cipher feedback(CFB)operation mode

用分组密码算法构造序列密码的一种工作模式。其特征是，使用分组算法当前输出的若干比特，与

明文逐比特异或得到密文，该密文同时更新算法下一时刻的输入序列。

[来源：GM/Z4001—2013，2.61]

3.5

# 输出反馈工作模式 output feedback（OFB）operation mode

用分组密码算法构造序列密码的一种工作模式，其特征是，将算法当前时刻输出的若干比特与明文逐比特异或得到密文，同时算法当前时刻的输出作为算法下一时刻的输入。

[来源：GM/Z4001—2013，2.108]

3.6

# 计数器工作模式 counter（CTR）operation mode

用分组密码算法构造序列密码的一种工作模式。其特征是，使用计数器的值作为算法的输入序列进行分组运算，将运算输出的若干比特与明文逐比特异或得到密文，然后对计数器作增量或者减量运算作为算法下一时刻的输入序列。

[来源：GM/Z4001—2013，2.37]

3.7

XEX结构 Xor- Encryption- Xor（XEX）construction

构造可调分组密码的一种结构，明文分组与掩码相异或后，使用分组密码算法加密，再将密文分组与掩码相异或。

3.8

带密文挪用的 XEX 可调分组密码工作模式 XEX tweakable block cipher with ciphertext stealing (XTS)operation mode

分组密码算法的一种工作模式，利用 XEX 结构完成数据的加密和解密。

3.9

带泛杂凑函数的计数器工作模式 universal hash function based CTR（HCTR）operation mode

分组密码算法的一种工作模式，是计数器模式的变体，它使用一个泛杂凑函数生成一个秘密掩码，作为计数器模式的初始向量。

3.10

分组链接工作模式 block chaining（BC）operation mode

分组密码算法的一种工作模式，当前的明文分组与所有前面密文分组异或，再加密得到当前的密文分组。

3.11

带非线性函数的输出反馈工作模式 output feedback with a nonlinear function（OFBNLF）operation mode

分组密码算法的一种工作模式，是 OFB 和 ECB 的变体，它的密钥随着每一个分组而改变。

3.12

# 密钥 key

控制密码算法运算的关键信息或参数。[来源：GM/Z4001—2013，2.63]

3.13

# 初始向量 initialization vector

IV

在密码变换中，为增加安全性或使密码设备同步而引入的用于数据变换的起始数据。

3.14

# 计数器 counter

长度为  $n$  比特的比特序列，用于计数器模式。注：  $n$  是分组密码的分组长度。

3.15

调柄 tweak

TW

某些模式中使用的一个参数，以增加加密过程的变化量；当使用同一个密钥时，不同加密过程应采用各不相同的调柄。

3.16

# 填充 padding

给一个数据串附加额外比特的操作。[来源：GB/T25069—2010，2.2.2.187]

3.17

反馈缓存 feedback buffer;FB用于为加密过程存储输入数据的变量。注：在启动点，FB的值为  $IV$

# 4 符号和缩略语

# 4.1 符号

下列符号适用于本文件。bit(S,i)：比特串  $S$  左起第  $i$  个比特，以1为起始值。 $C$  ：密文（比特串）。 $D_{K}$  ：使用密钥  $K$  的分组密码  $E$  的解密运算。 $E$  ：一个分组密码算法。 $E_{K}$  ：使用密钥  $K$  的分组密码  $E$  的加密运算。 $F_{i}$  ：第  $i$  个反馈变量。 $FB_{i}$  ：第  $i$  个反馈缓存。 $H$  ：一个泛杂凑函数。 $i$  ：选代值。 $j$  ：明文/密文分组的大小，  $1\leq j\leq k$ $k$  ：反馈变量的比特长度，  $1\leq k\leq n$ $K$  ：密钥。 $K^i$  ：密钥  $K$  的  $i$  次幂。 $K_{i}$  ：第  $i$  个密钥变量。 $|M|$  ：比特串  $M$  的比特长度。 $n$  ：分组密码算法的分组长度。 $One(m)$  ：连续  $m$  个比特“1”构成的比特串。 $P$  ：明文（比特串）。 $q$  ：明文/密文分组的个数。 $r$  ：反馈缓存的比特长度，  $n\leq r\leq 2n$ $T_{i}$  ：第  $i$  个计数值。

$X_{i}$  ：分组密码的第  $i$  个输入变量。 $Y_{i}$  ：分组密码的第  $i$  个输出变量。 $Z_{\mathrm{error}}(m)$  ：连续  $m$  个比特“0”构成的比特串。：比特串的连接。 $Z\gg 1$  ：比特串  $Z$  向右移动一位，左侧补0。 $(i)_2$  ：数字  $i$  的二进制表示。 $j\sim A$  ：比特串  $\mathcal{A}$  的左截取，要求  $\mathcal{A}$  的比特长度大于或等于  $j$  ，则  $j\sim A$  是由  $\mathcal{A}$  最左侧的  $j$  个比特组成的长度为  $j$  比特的比特串。 $A\sim j$  ：比特串  $\mathcal{A}$  的右截取，要求  $\mathcal{A}$  的比特长度大于或等于  $j$  ，则  $A\sim j$  是由  $\mathcal{A}$  最右侧的  $j$  个比特组成的长度为  $j$  比特的比特串。 $+$  ：比特串的比特级逻辑异或运算，要求  $A,B$  是长度相等的比特串，则  $A\oplus B$  表示  $\mathcal{A}$  和  $B$  的比特级逻辑异或所形成的比特串。 $\times$  ：有限域  $\mathrm{GF}(2^n)$  上的乘法。当  $n = 128$  时，本文件使用本原多项式  $1 + \alpha +\alpha^{2} + \alpha^{7} + \alpha^{128}$  定义GF $(2^{128}$  )上的乘法运算，其中  $\alpha$  是  $\mathrm{GF}(2^{128}$  )上的本原元。

$\alpha^i$ $\mathrm{GF}(2^{128})$  上的本原元  $\alpha$  的  $i$  次幂。

注：令  $U$  和  $\mathrm{V}$  是两个128位的比特串，则128位的比特串  $W = U\otimes V$  可以如下计算，其中比特串  $U$  和  $V$  看作有限域 $\mathrm{GF}(2^{128})$  上的元素，选取的本原多项式为  $1 + \alpha +\alpha^{2} + \alpha^{7} + \alpha^{128}$  。

a）令  $W = Zero(128),Z = U$  b）对于  $i = 1,2,\dots ,128$  ，执行以下两个步骤：1）若  $\mathrm{bit}(V,i) = 1$  ，则令  $W = W\oplus Z$  2）若  $\mathrm{bit}(Z,128) = 0$  ，则令  $Z = Z\gg 1$  ；否则令  $Z = (Z\gg 1)\oplus (11100001\mid Z\in \mathbb{Z}0(120))$  。

# 4.2 缩略语

下列缩略语适用于本文件。

BC：分组链接（Block Chaining）CBC：密文分组链接（Cipher Block Chaining）CFB：密文反馈（Cipher Feedback）CTR：计数器（Counter）ECB：电码本（Electronic Codebook）FB：反馈缓存（Feedback Buffer）HCTR：带泛杂凑函数的计数器（universal Hash function based CTR）OFB：输出反馈（Output Feedback）OFBNLF：带非线性函数的输出反馈（Output Feedback with a Nonlinear Function）XEX：先异或再加密再异或的结构（Xor- Encryption- Xor）XTS：带密文挪用的 XEX 可调分组密码（XEX Tweakable block cipher with ciphertext Stealing）

# 5 电码本工作模式

# 5.1 变量定义

ECB工作模式采用以下变量。

a）输入变量：

1）  $q$  个明文分组  $P_{1},P_{2},\dots ,P_{q}$  所组成的序列，每个分组都为  $n$  比特；2）密钥  $K$  ，需要加解密操作方约定一致，长度由分组密码算法  $E$  决定。

b）输出变量：

$q$  个密文分组  $C_1, C_2, \dots , C_q$  所组成的序列，每个分组都为  $n$  比特。

# 5.2 ECB的加密方式描述

逐个加密明文分组：  $C_i = E_K(P_i) \quad i = 1,2, \dots , q$  。此过程如图1所示。

![](https://cdn-mineru.openxlab.org.cn/result/2025-07-30/af863b18-5a8e-450e-8a0c-43cdb0eb93d4/fadfe4ef613ba33b34f9f6614c61ed71469bca2f3cd7b1fef3327609ad2420c9.jpg)  
图1 电码本工作模式加密算法

# 5.3 ECB的解密方式描述

逐个解密密文分组：  $P_i = D_K(C_i) \quad i = 1,2, \dots , q$  。此过程如图2所示。

![](https://cdn-mineru.openxlab.org.cn/result/2025-07-30/af863b18-5a8e-450e-8a0c-43cdb0eb93d4/d6bacd7a423a3f0b25973f6f5bbae296bd764c8cb64b4964f64b8c51af39a95e.jpg)  
图2 电码本工作模式解密算法

注1：ECB模式的工作性质见附录A的A.1，ECB模式的示例见附录B的B.2。注2：如果明文长度不满足分组长度的整数倍，则需要填充明文，见A.1.3，常见的填充方法见附录C。

# 6 密文分组链接工作模式

# 6.1 变量定义

CBC工作模式采用以下变量。

a）输入变量：

1）  $q$  个明文分组  $P_1, P_2, \dots , P_q$  所组成的序列，分组长度由分组算法  $E$  决定；2）密钥  $K$ ，需要加解密操作方约定一致，长度由分组密码算法  $E$  决定；3）初始向量  $IV$ ，需要加解密操作方约定一致，长度为  $n$  比特。

b）输出变量：

$q$  个密文分组  $C_1, C_2, \dots , C_q$  所组成的序列，每个分组都为  $n$  比特。

# 6.2 CBC的加密方式描述

对第一个明文分组进行加密：  $C_1 = E_K(P_1 \oplus IV)$

随后：  $C_i = E_K(P_i \oplus C_{i - 1}) \quad i = 2,3, \dots , q$

此过程如图3所示。初始向量  $IV$  用于生成第一个密文输出。之后的加密过程中，每个明文分组与前一个密文分组进行异或运算后再加密。

![](https://cdn-mineru.openxlab.org.cn/result/2025-07-30/af863b18-5a8e-450e-8a0c-43cdb0eb93d4/8125fc2faf56ed41688e6aa4c0bec06fa25ebfbb2e95ad026aae52cb6838a3bf.jpg)  
图3 密文分组链接工作模式加密算法

# 6.3 CBC的解密方式描述

对第一个密文分组进行解密：  $P_1 = D_K(C_1) \oplus IV$

随后：  $P_i = D_K(C_i) \oplus C_{i - 1} \quad i = 2,3, \dots , q$

此过程如图4所示。

![](https://cdn-mineru.openxlab.org.cn/result/2025-07-30/af863b18-5a8e-450e-8a0c-43cdb0eb93d4/7be07bd16123fb1222005b219f15b00e678ac50be7ac170ad9225017c5db9861.jpg)  
图4 密文分组链接工作模式解密算法

注1：CBC模式的工作性质见A.2，CBC模式的示例见B.3。注2：如果明文长度不满足分组长度的整数倍，则需要填充明文，见A.2.3，常见的填充方法见附录C。

# 7 密文反馈工作模式

# 7.1 变量定义

CFB工作模式采用以下变量。

a) 输入变量：

1)  $q$  个明文分组  $P_{1}, P_{2}, \dots , P_{q}$  所组成的序列，每个分组都为  $j$  比特；2) 密钥  $K$ ，需要加解密操作方约定一致，长度由分组密码算法  $E$  决定；3) 初始向量  $IV$ ，需要加解密操作方约定一致，长度为  $r$  比特。

b) 中间变量：

1)  $q$  个密码输入变量  $X_{1}, X_{2}, \dots , X_{q}$  所组成的序列，每个变量都为  $n$  比特；2)  $q$  个密码输出变量  $Y_{1}, Y_{2}, \dots , Y_{q}$  所组成的序列，每个变量都为  $n$  比特；3)  $q$  个临时变量  $Z_{1}, Z_{2}, \dots , Z_{q}$  所组成的序列，每个变量都为  $j$  比特；4)  $q - 1$  个反馈变量  $F_{1}, F_{2}, \dots , F_{q - 1}$  所组成的序列，每个变量都为  $k$  比特；5)  $q$  个反馈缓存  $FB_{1}, FB_{2}, \dots , FB_{q}$  所组成的序列，每个分组都为  $r$  比特。

c) 输出变量：

$q$  个密文分组  $C_{1}, C_{2}, \dots , C_{q}$  所组成的序列，每个分组都为  $j$  比特。

# 7.2 CFB的加密方式描述

设置反馈缓存  $FB$  的初始向量：  $FB_{1} = IV$

加密运算按照如下六个步骤进行：

a) 生成密码输入变量：  $X_{i} = n \sim FB_{i}$ ；b) 使用分组密码：  $Y_{i} = E_{K}(X_{i})$ ；c) 选择左侧的  $j$  比特：  $Z_{i} = j \sim Y_{i}$ ；d) 生成密文分组：  $C_{i} = P_{i} \oplus Z_{i}$ ；e) 生成反馈变量：  $F_{i} = One(k - j) \mid |C_{i}$ ；f) 更新反馈缓存：  $FB_{i + 1} = (FB_{i} \mid |F_{i}) \sim r$ 。

对  $i = 1,2, \dots , q$ ，重复上述步骤，最后一个循环结束于  $\mathrm{d}$ 。此过程如图5所示。分组密码输出变量  $Y$  的左侧  $j$  比特用来加密明文分组，  $Y$  的其他比特被舍弃。

![](https://cdn-mineru.openxlab.org.cn/result/2025-07-30/af863b18-5a8e-450e-8a0c-43cdb0eb93d4/e3ecb30076974e5dba28ba2ed1c00e4a8795f87d9415a0822c45b524d04b76a5.jpg)  
图5 密文反馈工作模式加密算法

生成新的反馈缓存  $FB_{i + 1}$  的方法是，把长度为  $k - j$  的全“1”比特串填充到密文分组  $C_{i}$  的左侧，得

到  $k$  比特反馈变量  $F_{i}$  ；然后舍弃当前反馈缓存  $FB_{i}$  左侧的  $k$  比特，并将  $F_{i}$  填充到其右侧。此后， $FB_{i + 1}$  左侧的  $n$  比特将用于加密下一个输入  $X$  。

# 7.3 CFB的解密方式描述

设置反馈缓存  $FB$  的初始向量：  $FB_{1} = IV$

解密运算按照如下六个步骤进行：

a）生成密码输入变量：  $X_{i} = n\sim FB_{i}$  b）使用分组密码：  $Y_{i} = E_{K}(X_{i})$  c）选择左侧的  $j$  比特：  $Z_{i} = j\sim Y_{i}$  d）生成明文分组：  $P_{i} = C_{i}\oplus Z_{i}$  e）生成反馈变量：  $F_{i} = One(k - j)\mid |C_{i}$  f）更新反馈缓存：  $FB_{i + 1} = (FB_{i}\mid |F_{i})\sim r$

对  $i = 1,2,\dots ,q$  ，重复上述步骤，最后一个循环结束于d)。此过程如图6所示。

![](https://cdn-mineru.openxlab.org.cn/result/2025-07-30/af863b18-5a8e-450e-8a0c-43cdb0eb93d4/c9437f6cfb8f6b6a94447ae05b7bdcfa229bf1bfeff81475f87c62bb5ccffb6e.jpg)  
图6密文反馈工作模式解密算法

注1：建议使用  $j$  和  $k$  的值相等的CFB模式。按照这种建议  $(j = k)$  ，加密操作和解密操作的e)可以写成  $F_{i} = C_{i}$ $(j = k)$  。

注2：CFB模式的工作性质见A.3，CFB模式的示例见B.4。注3：如果明文长度不满足分组长度的整数倍，则可能需要填充明文，见A.3.3，常见的填充方法见附录C。

# 8 输出反馈工作模式

# 8.1 变量定义

OFB工作模式采用以下变量。

a）输入变量：

1)  $q$  个明文分组  $P_{1},P_{2},\dots ,P_{q}$  所组成的序列，每个分组都为  $j$  比特；2）密钥  $K$  ，需要加解密操作方约定一致，长度由分组密码算法  $E$  决定；3）初始向量  $IV$  ，需要加解密操作方约定一致，长度为  $n$  比特。

b）中间变量：

1)  $q$  个密码输入变量  $X_{1},X_{2},\dots ,X_{q}$  所组成的序列，每个变量都为  $n$  比特；2)  $q$  个密码输出变量  $Y_{1},Y_{2},\dots ,Y_{q}$  所组成的序列，每个变量都为  $n$  比特；3)  $q$  个临时变量  $Z_{1},Z_{2},\dots ,Z_{q}$  所组成的序列，每个变量都为  $j$  比特。

c) 输出变量：

$q$  个密文分组  $C_1, C_2, \dots , C_q$  所组成的序列，每个分组都为  $j$  比特。

# 8.2 OFB的加密方式描述

设置密码输入变量  $X$  的初始向量：  $X_{1} = IV$

加密运算按照如下四个步骤进行：

a) 使用分组密码：  $Y_{i} = E_{K}(X_{i})$ ；b) 选择左侧的  $j$  比特：  $Z_{i} = j \sim Y_{i}$ ；c) 生成密文分组：  $C_{i} = P_{i} \oplus Z_{i}$ ；d) 反馈操作：  $X_{i + 1} = Y_{i}$ 。

对  $i = 1,2, \dots , q$ ，重复上述步骤，最后一个循环结束于c)。此过程如图7所示。每次使用分组密码所生成的结果  $Y_{i}$  被用来反馈并成为  $X$  的下一个值，即  $X_{i + 1}$ 。 $Y_{i}$  的左侧  $j$  比特用来加密明文分组。

![](https://cdn-mineru.openxlab.org.cn/result/2025-07-30/af863b18-5a8e-450e-8a0c-43cdb0eb93d4/12ca4f304f1f6d4424f5afd2aeb9f7fa17dd7f98a2542623df8dbfd55aa972fc.jpg)  
图7 输出反馈工作模式加密算法

# 8.3 OFB的解密方式描述

设置密码输入变量  $X$  的初始向量：  $X_{1} = IV$ 。解密运算按照如下四个步骤进行：

a) 使用分组密码：  $Y_{i} = E_{K}(X_{i})$ ；b) 选择左侧的  $j$  比特：  $Z_{i} = j \sim Y_{i}$ ；c) 生成明文分组：  $P_{i} = C_{i} \oplus Z_{i}$ ；d) 反馈操作：  $X_{i + 1} = Y_{i}$ 。

对  $i = 1,2, \dots , q$ ，重复上述步骤，最后一个循环结束于c)。此过程如图8所示。解密过程与加密过程仅在步骤c)有不同，相应的变量值  $X_{i}$  和  $Y_{i}$  是相同的。

![](https://cdn-mineru.openxlab.org.cn/result/2025-07-30/af863b18-5a8e-450e-8a0c-43cdb0eb93d4/3d466c616b52106e76305e11ef55b05a943357bfb5a350a8473836cf91f58b8e.jpg)  
图8 输出反馈工作模式解密算法

注1：OFB模式的工作性质见A.4，OFB模式的示例见B.5。注2：如果明文长度不满足分组长度的整数倍，则可能需要填充明文，见A.4.3，常见的填充方法见附录C。

# 9 计数器工作模式

# 9.1 变量定义

CTR工作模式采用以下变量。

a）输入变量：

1)  $q$  个明文分组  $P_{1},P_{2},\dots ,P_{q}$  所组成的序列（其中  $P_{1},P_{2},\dots ,P_{q - 1}$  都为  $n$  比特，  $P_{q}$  为  $d$  比特且  $0< d\leq n$  ）；

2）密钥  $K$  ，需要加解密操作方约定一致，长度由分组密码算法  $E$  决定；

3)  $q$  个计数序列  $T_{1},T_{2}\dots ,T_{q}$  ，需要加解密操作方约定一致，每个都为  $n$  比特。

b）中间变量：

1)  $q$  个密码输出变量  $Y_{1},Y_{2},\dots ,Y_{q}$  所组成的序列，每个变量都为  $n$  比特；

2）临时变量  $z$  ，长度为  $d$  比特。

c）输出变量：

$q$  个密文分组  $C_1,C_2,\dots ,C_q$  所组成的序列（其中  $C_1,C_2,\dots ,C_{q - 1}$  都为  $n$  比特，  $C_q$  为  $d$  比特且  $0< d\leq n$  ）。

# 9.2CTR的加密方式描述

加密运算按照四个步骤进行：

a）加密计数序列：  $Y_{i} = E_{K}(T_{i})\quad i = 1,2,\dots ,q$  b）加密前  $q - 1$  个明文分组：  $C_i = P_i\bigoplus Y_i\quad i = 1,2,\dots ,q - 1$  c）选择  $Y_{q}$  左侧的  $d$  比特：  $Z = d\sim Y_{q}$  d）加密最后一个明文分组：  $C_q = P_q\bigoplus Z$  。此过程如图9所示。

![](https://cdn-mineru.openxlab.org.cn/result/2025-07-30/af863b18-5a8e-450e-8a0c-43cdb0eb93d4/0c169445a14fc56afa4589e2c1622ce27c884f55fa673406037c8ffcdf0d7847.jpg)  
图9 计数器工作模式加密算法

# 9.3 CTR的解密方式描述

解密运算按照以下四个步骤进行：

a) 加密计数序列：  $Y_{i} = E_{i}(T_{i})$ $i = 1,2,\dots ,q$  b) 解密前  $q - 1$  个密文分组：  $P_{i} = C_{i}\oplus Y_{i}$ $i = 1,2,\dots ,q - 1$  c) 选择  $Y_{q}$  左侧的  $d$  比特：  $Z = d\sim Y_{q}$  d) 解密最后一个密文分组：  $P_{q} = C_{q}\oplus Z$  。此过程如图10所示。

![](https://cdn-mineru.openxlab.org.cn/result/2025-07-30/af863b18-5a8e-450e-8a0c-43cdb0eb93d4/6529b22f2309a70350df91e0dbdcc5db6ee38773c57bf106c67ac3d13643186a.jpg)  
图10 计数器工作模式解密算法

注：CTR模式的工作性质见A.5，CTR模式的示例见B.6。

# 10 带密文挪用的XEX可调分组密码工作模式

# 10.1 变量定义

XTS工作模式采用以下变量：

a) 输入变量：

1)  $q$  个明文分组  $P_{1},P_{2},\dots ,P_{q}$  所组成的序列[其中  $P_{1},P_{2},\dots ,P_{q - 1}$  都为  $n$  比特，  $P_{q}$  为  $d$

比特，满足  $0< d\leq n$  且  $(q - 1)n + d\geq n]$

2）密钥  $K_{1}$  和  $K_{2}$ ，需要加解密操作方约定一致，长度均由分组密码算法  $E$  决定；

3）调柄  $TW$ ，需要加解密操作方约定一致，长度为  $n$  比特。

b）中间变量：

1)  $q$  个密码输入变量  $X_{1},X_{2},\dots ,X_{q}$  所组成的序列，每个变量均为  $n$  比特；

2）临时变量  $Z$ ，长度为  $n$  比特。

c）输出变量：

$q$  个密文分组  $C_1,C_2,\dots ,C_q$  所组成的序列[其中  $C_1,C_2,\dots ,C_{q - 1}$  都为  $n$  比特，  $C_q$  为  $d$  比特，满足  $0< d\leq n$  且  $(q - 1)n + d\geq n]$

根据4.1中关于有限域乘法  $②$  的定义，本章中所有有限域乘法运算  $②$  按照“左低右高”的方式处理变量，即变量最左侧为其最低位。

# 10.2 XTS的加密方式描述

# 10.2.1 明文长度满足整数倍分组长度

此种情况下，  $d = n$  且  $q\geq 1$  。对  $q$  个明文分组  $P_{1},P_{2},\dots ,P_{q}$  进行加密运算按照如下四个步骤进行：

a）计算掩码：  $T_{i} = E_{K_{2}}(TW)\otimes \alpha^{i - 1}$  b）计算密码输入变量：  $X_{i} = P_{i}\oplus T_{i}$  c）使用分组密码：  $Y_{i} = E_{K_{1}}(X_{i})$  d）生成密文分组：  $C_i = Y_i\oplus T_i$  。

# 10.2.2 明文长度不满足整数倍分组长度

此种情况下，  $0< d< n$  且  $q\geq 2$  。对前  $q - 1$  个明文分组  $P_{1},P_{2},\dots ,P_{q - 1}$  进行加密运算按照如下四个步骤进行：

a）计算掩码：  $T_{i} = E_{K_{2}}(TW)\otimes \alpha^{i - 1}$  b）计算密码输入变量：  $X_{i} = P_{i}\oplus T_{i}$  c）使用分组密码：  $Y_{i} = E_{K_{1}}(X_{i})$  d）生成密文分组：  $C_i = Y_{i}\oplus T_{i}$  。对最后一个明文分组  $P_{q}$  进行加密运算按照如下五个步骤进行：

a）通过密文挪用设置临时变量：  $Z = P_{q}\mid \mid (C_{q - 1}\sim (n - d))$  b）计算掩码：  $T_{q} = E_{K_{2}}(TW)\otimes \alpha^{q - 1}$  c）计算密码输入变量：  $X_{q} = Z\oplus T_{q}$  d）使用分组密码：  $Y_{q} = E_{K_{1}}(X_{q})$  e）生成密文分组：  $C_{q} = Y_{q}\oplus T_{q}$  。

密文重排按照如下三个步骤进行：

a）设置临时变量：  $Z = C_{q - 1}$  b）生成第  $q - 1$  个密文分组：  $C_{q - 1} = C_q$  c）生成第  $q$  个密文分组：  $C_{q} = d\sim Z$  。此过程如图11所示。

![](https://cdn-mineru.openxlab.org.cn/result/2025-07-30/af863b18-5a8e-450e-8a0c-43cdb0eb93d4/6209025636a882ee3acef590453037dff91ccc16d01686400d4ef11466dbeb9d.jpg)  
图11 带密文挪用的XEX可调分组密码工作模式加密算法

# 10.3 XTS的解密方式描述

# 10.3.1 密文长度满足整数倍分组长度

此种情况下，  $d = n$  且  $q\geq 1$  0对  $q$  个密文分组  $C_1,C_2,\dots ,C_q$  进行解密运算按照如下四个步骤进行：

a) 计算掩码：  $T_{i} = E_{K_{1}}(TW)\otimes \alpha^{i - 1}$  b) 计算密码输入变量：  $X_{i} = C_{i}\oplus T_{i}$  c) 使用分组密码：  $Y_{i} = D_{K_{1}}(X_{i})$  d) 生成明文分组：  $P_{i} = Y_{i}\oplus T_{i}$  。

# 10.3.2 密文长度不满足整数倍分组长度

此种情况下，  $d\leq n$  且  $q\geq 2$  0对前  $q - 2$  个密文分组  $C_1,C_2,\dots ,C_{q - 2}$  进行解密运算按照如下四个步骤进行：

a) 计算掩码：  $T_{i} = E_{K_{1}}(TW)\otimes \alpha^{i - 1}$  b) 计算密码输入变量：  $X_{i} = C_{i}\oplus T_{i}$  c) 使用分组密码：  $Y_{i} = D_{K_{1}}(X_{i})$  d) 生成明文分组：  $\boldsymbol {P}_i = \boldsymbol {Y}_i\oplus \boldsymbol {T}_i$  。对最后两个密文分组  $C_{K_1}$  和  $C_q$  进行解密运算按照如下九个步骤进行：

a) 计算掩码：  $T_{q} = E_{K_{2}}(TW)\otimes \alpha^{q - 1}$  b) 计算密码输入变量：  $X_{q} = C_{q - 1}\oplus T_{q}$  c) 使用分组密码：  $Y_{q} = D_{K_{1}}(X_{q})$  d) 生成临时变量：  $Z = Y_{q}\oplus T_{q}$  e) 生成明文分组：  $P_{q} = d\sim Z$  f) 计算掩码：  $T_{q - 1} = E_{K_{2}}(TW)\otimes \alpha^{q - 2}$

g）计算密码输入变量：  $X_{q - 1} = (C_q\mid ((Z\sim (n - d)))\oplus T_{q - 1}$  h）使用分组密码：  $Y_{q - 1} = D_{K_1}(X_{q - 1})$  i）生成明文分组：  $P_{q - 1} = Y_{q - 1}\oplus T_{q - 1}$  。此过程如图12所示。

![](https://cdn-mineru.openxlab.org.cn/result/2025-07-30/af863b18-5a8e-450e-8a0c-43cdb0eb93d4/a1a5ca2f9792d257f4461de1989b78619834c02f77afe569269609d6da4946ab.jpg)  
图12 带密文挪用的XEX可调分组密码工作模式解密算法

注：XTS模式的工作性质见A.6，XTS模式的示例见B.7。

# 11 带泛杂凑函数的计数器工作模式

# 11.1 变量定义

HCTR工作模式采用以下变量。

a）输入变量：

1）  $q$  个明文分组  $P_{1},P_{2},\dots ,P_{q}$  所组成的序列[其中  $P_{1},P_{2},\dots ,P_{q - 1}$  都为  $n$  比特，  $P_{q}$  为  $d$  比特，满足  $0< d\leq n$  且  $(q - 1)n + d\geq n]$

2）两个密钥  $K_{1}$  和  $K_{2}$ ，需要加解密操作方约定一致，其中  $K_{1}$  的长度由分组密码算法  $E$  决定，  $K_{2}$  的长度为  $n$  比特；

3）调柄  $TW$ ，需要加解密操作方约定一致，长度为  $n$  比特。

b）中间变量：

两个临时变量  $Z_{1}$  和  $Z_{2}$ ，每个变量都为  $n$  比特。

c）输出变量：

$q$  个密文分组  $C_1,C_2,\dots ,C_q$  所组成的序列[其中  $C_1,C_2,\dots ,C_{q - 1}$  都为  $n$  比特，  $C_q$  为  $d$  比特，满足  $0< d\leq n$  且  $(q - 1)n + d\geq n]$  。

HCTR工作模式使用一个泛杂凑函数  $H$  。  $H$  使用密钥  $K$  压缩一个比特串  $M$ ，记作：

$$
H_{K}(M) = M_{1}\otimes K^{m + 1}\oplus \dots \oplus (M_{m}\mid |Zero(n - d))\otimes K^{2}\oplus (|M|)_{2}\otimes K,
$$

其中  $M = M_{1}\mid \mid \dots \mid \mid M_{m},M_{1},\dots ,M_{m - 1}$  和  $K$  长度都是  $n$  比特，  $M_{m}$  长度是  $d$  比特，  $1\leq d\leq n$  。

根据4.1中关于有限域乘法  $\times$  的定义，泛杂凑函数  $H$  使用的有限域乘法运算  $\times$  按照“左低右高”的方式处理变量，即变量最左侧为其最低位；采用的CTR工作模式按照“左高右低”的方式处理变量，即变量最左侧为其最高位。

# 11.2 HCTR的加密方式描述

对  $q$  个明文分组  $P_{1},P_{2},\dots ,P_{q}$  进行加密运算按照如下四个步骤进行：

a）生成临时变量：  $Z_{1}:Z_{1} = P_{1}\bigoplus H_{K_{2}}(P_{2}||\dots ||P_{q}||TW)$  b）生成临时变量：  $Z_{2}:Z_{2} = E_{K_{1}}(Z_{1})$  c）生成第一个分组之外的密文分组：  $(C_{2},\dots ,C_{q}) = CTR_{K_{1}}(P_{2},\dots ,P_{q})$  其中CTR模式用到的计数器序列是  $T_{i} = Z_{1}\oplus Z_{2}\oplus (i)_{2},i = 1,\dots ,q - 1$  d）生成第一个密文分组  $C_1:C_1 = Z_2\oplus H_{K_2}(C_2||\dots ||C_q||TW)$  。此过程如图13所示。

![](https://cdn-mineru.openxlab.org.cn/result/2025-07-30/af863b18-5a8e-450e-8a0c-43cdb0eb93d4/406624ee39fa90fe75f46a64caf9624255ed924f9268b92c615bb981e31f9add.jpg)  
图13 带泛杂凑函数的计数器工作模式加密算法

# 11.3 HCTR的解密方式描述

对  $q$  个密文分组  $C_1,C_2,\dots ,C_q$  进行解密运算按照如下四个步骤进行：

a）生成临时变量  $Z_{2}:Z_{2} = C_{1}\oplus H_{K_{2}}(C_{2}||\dots ||C_{q}||TW)$  b）生成临时变量  $Z_{1}:Z_{1} = D_{K_{1}}(Z_{2})$  c）生成第一个分组之外的明文分组：  $(P_{2},\dots ,P_{q}) = CTR_{K_{1}}(C_{2},\dots ,C_{q})$  其中CTR模式用到的计数器序列是  $T_{i} = Z_{1}\oplus Z_{2}\oplus (i)_{2},i = 1,\dots ,q - 1$  d）生成第一个明文分组  $P_{1}:P_{1} = Z_{1}\oplus H_{K_{2}}(P_{2}||\dots ||P_{q}||TW)$  。此过程如图14所示。

![](https://cdn-mineru.openxlab.org.cn/result/2025-07-30/af863b18-5a8e-450e-8a0c-43cdb0eb93d4/d533cd91c729d99b6a3de5392edcc0b1f0ef51d3bebcc5443b9d6a262d7bd54a.jpg)  
图14 带泛杂凑函数的计数器工作模式解密算法

注1：HCTR模式的工作性质见A.7，HTCR模式的示例见B.8。注2：泛杂凑函数是一类使用密钥的高效率压缩函数，见参考文献[1]。在有限域  $\mathrm{GF}(2^{128})$  上， $\cdot$  的优先级高于  $(\Xi)$ 。

# 12 分组链接工作模式

# 12.1 变量定义

BC工作模式采用以下变量。

a）输入变量：

1）  $q$  个明文分组  $P_{1},P_{2},\dots ,P_{q}$  所组成的序列，每个分组都为  $n$  比特；2）密钥  $K$  ，需要加解密操作方约定一致，长度由分组密码算法  $K$  决定；3）初始向量  $IV$  ，需要加解密操作方约定一致，长度为  $n$  比特。b）中间变量： $q$  个反馈变量  $F_{1},F_{2},\dots ,F_{q}$  所组成的序列，每个变量都为  $n$  比特。c）输出变量： $q$  个密文分组  $C_1,C_2,\dots ,C_q$  所组成的序列，每个分组都为  $n$  比特。

# 12.2 BC的加密方式描述

设置反馈变量初始向量： $F_{1} = IV$ 。

加密运算按照如下两个步骤进行：

a）生成密文分组： $C_i = E_K(P_i\oplus F_i)$ ；

b）生成反馈变量： $F_{i + 1} = F_i\oplus C_i$ 。

对  $i = 1,2,\dots ,q$  ，重复上述步骤，最后一个循环结束于a)。此过程如图15所示。初始向量  $IV$  用于生成第一个密文输出。之后的加密过程中，每个密文与当时反馈变量进行异或运算，生成下一个反馈变量。

![](https://cdn-mineru.openxlab.org.cn/result/2025-07-30/af863b18-5a8e-450e-8a0c-43cdb0eb93d4/63ad1ebe26651c62535f1630f0464c9ccfc96590aadcab78059812a3d0f6dad5.jpg)  
图15 分组链接工作模式加密算法

# 12.3 BC的解密方式描述

设置反馈变量初始向量：  $F_{1} = IV$  0解密运算按照如下两个步骤进行：a）生成明文分组：  $P_{i} = F_{i}\bigoplus D_{K}(C_{i})$  b）生成反馈变量：  $F_{i + 1} = F_{i}\bigoplus C_{i}$  0对  $i = 1,2,\dots ,q$  ，重复上述步骤，最后一个循环结束于a)。此过程如图16所示。

![](https://cdn-mineru.openxlab.org.cn/result/2025-07-30/af863b18-5a8e-450e-8a0c-43cdb0eb93d4/27d9bd73ab52a66715034ca41b6694f561aca5fc8c2ab630d8174c047a159aac.jpg)  
图16 分组链接工作模式解密算法

注1：BC模式的工作性质见A.8，BC模式的示例见B.9。注2：如果明文长度不满足分组长度的整数倍，则需要填充明文，见A.8.3，常见的填充方法见附录C。

# 13 带非线性函数的输出反馈工作模式

# 13.1 变量定义

OFBNLF工作模式采用以下变量。

a）输入变量：

1）  $q$  个明文分组  $P_{1},P_{2},\dots ,P_{q}$  所组成的序列，每个分组都为  $n$  比特；2）密钥  $K$  ，需要加解密操作方约定一致，长度由分组密码算法  $E$  决定；3）初始向量  $IV$  ，需要加解密操作方约定一致，长度为  $n$  比特。

b) 中间变量： $q + 1$  个密钥变量  $K_{0}, K_{1}, \dots , K_{q}$  所组成的序列，每个变量都为  $n$  比特。c) 输出变量： $q$  个密文分组  $C_{1}, C_{2}, \dots , C_{q}$  所组成的序列，每个分组都为  $n$  比特。

# 13.2 OFBNLF的加密方式描述

设置密钥变量初始向量：  $K_{0} = IV$

加密运算按照如下两个步骤进行：

a）生成密钥变量：  $K_{i} = E_{K}(K_{i - 1})$  b) 生成密文分组：  $C_{i} = E_{K_{i}}(P_{i})$

对  $i = 1,2,\dots ,q$  ，重复上述步骤，最后一个循环结束于b)。此过程如图17所示。每次使用的密钥变量  $K_{i}$  被密钥  $K$  加密并成为下一个分组的密钥变量  $K_{i + 1}$  。

![](https://cdn-mineru.openxlab.org.cn/result/2025-07-30/af863b18-5a8e-450e-8a0c-43cdb0eb93d4/6d43e2990c44a6df17100b81a0d075cb781e854ed8aa194a60cdefc90e4bc850.jpg)  
图17 带非线性函数的输出反馈工作模式加密算法

# 13.3 OFBNLF的解密方式描述

设置密钥变量初始向量：  $K_{0} = IV$  解密运算按照如下两个步骤进行：

a）生成密钥变量：  $K_{i} = E_{K}(K_{i - 1})$  b) 生成明文分组：  $P_{i} = D_{K_{i}}(C_{i})$

对  $i = 1,2,\dots ,q$  ，重复上述步骤，最后一个循环结束于b)。此过程如图18所示。  $K_{i}$  与加密过程中相应的值是相同的。

![](https://cdn-mineru.openxlab.org.cn/result/2025-07-30/af863b18-5a8e-450e-8a0c-43cdb0eb93d4/78225b7639520de62e065cb00b1e3fc46feee0d81af490cebeb8723d559ef2b3.jpg)  
图18 带非线性函数的输出反馈工作模式解密算法

注1：OFBNLF模式的工作性质见A.9，OFBNLF模式的示例见B.10。注2：如果明文长度不满足分组长度的整数倍，则需要填充明文，见A.9.3，常见的填充方法见附录C。

# 附录A（资料性）工作模式的性质

# A.1 电码本工作模式的性质

# A.1.1 场景

A.1.1 场景在各计算机终端之间，或者多人共用一个计算机终端所交换的二进制数据可能会有重复或者共同使用的序列。在ECB工作模式中，相同的明文分组（使用相同的密钥）生成相同的密文分组。

# A.1.2 性质

ECB工作模式的性质有：

a）对某一个分组的加密或解密可独立于其他分组进行；b）对密文分组的重排将导致相应明文分组的重排；c）相同的明文分组(使用相同的密钥)总是生成相同的密文分组，这使得它容易遭受“字典攻击”，这种字典是由对应的明文和密文分组构成的。

对于超过一个分组长度的明文一般建议不使用ECB工作模式。对于可接受重复性（例如，输入分组绝不重复），必须单独访问或随机访问各个分组的特殊使用情况，ECB的用法可以在未来的标准中规定。

# A.1.3 填充明文

只有长度为分组长度的整数倍的明文才能被加密或解密。其他长度的明文需要被填充至分组长度的整数倍。

# A.1.4 差错扩散

A.1.4 差错扩散在ECB工作模式中，如果一个密文分组中存在一个或多个比特的差错，则只会影响该密文分组的解密；该解密将导致得到的明文分组中每个明文比特以  $50\%$  的概率出现差错。

# A.1.5 同步

A.1.5 同步如果加密或解密之间的分组边界丢失了（例如由于一个比特的滑动），则在重新建立正确的分组边界之前，加密与解密之间将失去同步。如果分组边界丢失，则所有解密操作的结果都不正确。

# A.2 密文分组链接工作模式的性质

# A.2.1 场景

A.2.1 场景只要使用相同的密钥和初始向量对相同的明文进行加密，CBC工作模式将生成相同的密文。介意这种性质的用户需要采用相应方法来改变明文的起始分组、密钥或初始向量。一种可能的方法是将一个唯一的标识符（例如一个递增计数器）加到每个CBC消息的起始位置。在对长度不能增加的明文进行加密时可使用某种方法从明文中计算出一个值，例如明文的随机访问存储方式的地址。

# A.2.2 性质

CBC工作模式的性质有：

a）链接操作使得密文分组依赖于当前的和以前的明文分组，因此调换密文分组的顺序不可能使得明文分组的顺序对应调换；b）使用不同的IV以防止同一明文加密成同一密文；c）CBC模式的安全性证明见参考文献[2]。

# A.2.3 填充明文

只有长度为分组长度的整数倍的明文才能被加密或解密，其他长度的明文需要被填充。如果不能填充，则可以使用特殊方法处理最后一个分组，下面给出两个方法。

第一种方法处理一个不完整的明文分组[即：一个  $j(j< n)$  比特的明文分组  $P_{q}$  ，其中  $q$  大于1]，按照下面描述的OFB工作模式进行加密：

a）加密：  $C_{q} = P_{q}\oplus (j\sim E_{K}(C_{q - 1}))$

b）解密：  $P_{q} = C_{q}\oplus (j\sim E_{K}(C_{q - 1}))$

如果IV不是秘密的或者与同一个密钥一起被多次使用（见A.4)，那么最后的分组容易受到“选择明文攻击”。

第二种方法称作“密文挪用”。如果最后两个明文分组为  $P_{q - 1}$  和  $P_{q}$  ，其中  $P_{q - 1}$  长度为  $n$  比特，  $P_{q}$  长度为  $j(j< n)$  比特，  $q$  大于1。

a）加密：

设  $C_{q - 1}$  为使用6.2所描述的方法由  $P_{q - 1}$  导出的密文分组。令

$$
C_{q} = E_{K}(C_{q - 1}\oplus (P_{q}\mid |Zero(n - j))),C_{q - 1}^{*} = j\sim C_{q - 1}
$$

因此最后两个密文分组是  $C_{q}$  和  $C_{q - 1}^{*}$  。此过程如图A.1所示。

![](https://cdn-mineru.openxlab.org.cn/result/2025-07-30/af863b18-5a8e-450e-8a0c-43cdb0eb93d4/b5a82d6909fef8125ad7e6368d4b157b013e7c7aa725ecf4ce445d752a968dda.jpg)  
图A.1密文分组链接工作模式采用密文挪用的加密算法

b）解密：

首先对  $C_{q}$  进行解密，对所得明文分组的左边  $j$  比特和右边  $n - j$  比特分别如下处理：

$$
P_{q} = (j\sim D_{K}(C_{q}))\oplus C_{q - 1}^{*},
$$

$$
P_{q - 1} = D_{K}(C_{q - 1}^{*}\mid |D_{K}(C_{q})\sim (n - j))\oplus C_{q - 2}.
$$

此过程如图A.2所示。

![](https://cdn-mineru.openxlab.org.cn/result/2025-07-30/af863b18-5a8e-450e-8a0c-43cdb0eb93d4/f4b0a34efc7cfaf722604e105b875212750cf46e86476fe6d9bdbceb6fb10f3d.jpg)  
图A.2 密文分组链接工作模式采用密文挪用的解密算法

# A.2.4 差错扩散

在CBC工作模式中，一个密文分组中的一个或多个比特差错会影响两个分组（即发生差错的分组和随后的分组）的解密。第  $i$  个密文分组中的差错对于所生成的明文有以下影响：第  $i$  个明文分组每比特以  $50\%$  的概率出错，第  $i + 1$  个明文分组的差错模式与第  $i$  个密文分组相同。如果在一个不到  $n$  比特的分组中出现差错，差错扩散取决于所选择的处理方法。若使用A.2.3第一个方法，在被解密的较短的分组中，与明文出错比特直接对应的那些比特也会出错。

# A.2.5 同步

如果解密或解密之间的分组边界丢失了（例如由于一个比特的滑动），则在重新建立正确的分组边界之前，加密与解密之间将失去同步。如果分组边界丢失，所有解密操作的结果都是不正确的。

# A.3 密文反馈工作模式的性质

# A.3.1 场景

只要使用同样的密钥和初始向量对相同的明文进行加密，CFB工作模式将生成相同的密文。介意这种特性的用户需要采用某种办法来改变起始明文分组、密钥或初始向量。一种可能的办法是将一个唯一的标识符（例如一个递增计数器）加到每个CFB消息的开始处。在对大小不能增加的记录进行加密时可采用另一种办法，它使用诸如初始向量的某个值，这个值能从记录中计算出来且不用知道其内容（例如它的按随机访问存储方式的地址）。

# A.3.2 性质

CFB模式的性质有：

a）链接操作使得密文分组依赖于当前的和除确定数目以外的所有以前的明文分组，该数目取决于  $r, k$  和  $j$  的选择（见图5、图6）。因此对  $j$  比特密文分组的重新排序不会导致对相应的  $j$  比特明文分组的重新排序；b）加解密操作方需要约定一致的参数  $r, k$  和  $j$ ，参数的取值可公开；c）使用不同的IV值从而防止同一明文加密成同一密文；d）CFB模式的加密和解密过程都使用分组密码的加密操作；

e）CFB模式的强度依赖于  $k$  的大小  $(j = k$  时最大)以及  $j,k,n$  和  $r$  的相对大小；注：  $j< k$  将导致输入分组的值重复出现的概率增加。这种重复出现将会泄露明文比特之间的线性关系。f）对于每个明文，选择一个较小的  $j$  值将需要更多次的分组密码操作，从而引起更大的处理开销；g）选择  $r\geq n + k$  使得能对分组密码进行流水线式连续操作；h）CFB模式的安全性证明见参考文献[3]。

# A.3.3 填充明文

只有长度为  $j$  比特倍数的明文才能被加密。其他长度的明文需要填充至  $j$  比特的整数倍。但是，经常选择  $j$  的大小使得明文无需进行填充，例如对于明文的最后部分可以修改  $j$  。

# A.3.4 差错扩散

CFB模式中，任一  $j$  比特密文的差错都将影响随后密文的解密，直到出错的比特移出CFB反馈缓存为止。第  $j$  个密文分组中的差错对生成的明文有下列影响：第  $i$  个明文分组与第  $i$  个密文分组有相同的差错模式。在所有未正确接收的比特被移出反馈缓存之前，随后的明文分组的每一比特出错的概率为  $50\%$  。

# A.3.5 同步

如果加密和解密之间的分组边界丢失了（例如由于一个比特的滑动），则在  $j$  比特分组重新建立的  $r$  比特之后，密码同步将被重新建立。如果丢失  $j$  比特的倍数，则在  $r$  比特之后将重新建立同步。

# A.4 输出反馈工作模式的性质

# A.4.1 场景

只要使用同样的密钥和初始向量对相同的明文进行加密，OFB模式将生成相同的密文。此外，当使用相同的密钥和  $IV$  时，OFB模式中将会生成相同的密钥流，因此，为了保密起见，对于一个给定的密钥，一个特定的  $IV$  只能使用一次。

# A.4.2 性质

OFB模式的性质有：

a）没有链接操作会使得OFB模式容易受到主动的攻击；b）使用不同的  $IV$  值生成不同的密钥流，可防止同一明文加密成同一密文；c）OFB模式的加密和解密过程都使用分组密码的加密运算；d）OFB模式不依赖明文来生成用于对明文进行异或运算的密钥流；e）加解密操作方需要约定一致的参数  $j$  ，参数的取值可公开；f）对于每个明文，选择一个较小的  $j$  值将需要更多次的分组密码操作，从而引起更大的处理开销。

# A.4.3 填充明文

只有长度为  $j$  比特倍数的明文才能被加密。其他长度的明文需要填充至  $j$  比特的整数倍。但是，经常选择  $j$  的大小使得明文无需进行填充，例如对于明文的最后部分可以修改  $j$  。

# A.4.4 差错控制

OFB模式中，密文中每一差错比特只会引起明文中同一位置出现一个差错比特，不影响明文其他

位置。

# A.4.5 同步

OFB模式不是自动同步的。如果加密和解密两个操作不同步，系统需要重新初始化。这种同步丢失可能由于插入或丢失任意数目的密文所引起。

每次重新初始化应使用一个新的IV值，它不同于与同一个密钥一起使用的以前的IV值。其原因是对于相同的参数，每次会生成相同的比特流，这将易于受到“已知明文攻击”。

# A.5 计数器工作模式的性质

# A.5.1 场景

A.5.1 场景计数器模式下的分组密码算法使用序列号作为算法的输入。不是用加密算法的输出填充寄存器，而是将一个计数器输入到寄存器中。每一个分组完成加密后，计数器都要增加某个常数，典型值是1。没有什么是专供计数器用的，它不必根据可能的输入计数。可以将随机序列发生器作为分组算法的输入，而不必考虑其密码上是否安全。

# A.5.2 性质

CTR的性质有：

A.5.2 性质CTR的性质有：a）加密运算可并行处理，吞吐量仅受可使用并行数量的限制；b）使用不同的计数器生成不同的密钥流，可防止同一明文加密成同一密文；c）CTR工作模式的加密和解密过程都使用分组密码的加密运算；d）CTR工作模式不依赖明文生成用于对明文进行异或运算的密钥流。

# A.5.3 填充明文

计数器模式不需要填充明文，可以处理任意长度的明文。

# A.5.4 差错扩散

A.5.4 差错扩散CTR模式不在生成的明文输出中扩散密文差错。密文中每一差错比特只会引起解密后的明文中出现一个差错比特。

# A.5.5 同步

CTR工作模式不是自动同步的。如果加密和解密两个操作不同步，系统需要重新初始化。这种同步丢失可能由于插入或丢失任意数目的密文所引起。

每次重新初始化应使用一个新的计数器值，它不同于与同一个密钥一起使用的以前的计数器值。其原因是在对于相同的参数，每次都要生成相同的密钥流。这将易于受到“已知明文攻击”。

# A.6 带密文挪用的XEX可调分组密码工作模式的性质

# A.6.1 场景

A.6.1 场景XTS模式可以用于磁盘扇区加密等特殊的加密环境，其中调柄值用于表示扇区地址；只要使用同样的密钥和调柄对相同的明文进行加密，XTS模式将产生相同的密文。每个明文都应指定一个数值为非负整数的调柄。调柄数值应指定由一个任意的非负整数起始，并连续增长。该工作模式不适用于明文长度小于分组密码分组长度的情形。

# A.6.2 性质

XTS模式的性质有：

A.6.2 性质XTS模式的性质有：a) 加密运算可并行处理，吞吐量仅受可使用并行数量的限制；b) 使用不同的调柄产生不同的掩码序列，可防止同一明文加密成同一密文；c) 明文和对应的密文具有相同的长度；d) XTS模式不依赖明文产生用于对明文进行异或运算的密钥流；e) XTS模式具备可证明安全的理论保障。在底层分组密码算法具备超伪随机性质的情况下，XTS模式被证明是超伪随机的，安全界是生日界。具体安全分析见参考文献[4]和参考文献[5]。

# A.6.3 填充明文

消息无须填充。消息长度应不少于一个分组。当消息长度不是分组长度的整数倍时，将在加密阶段的末尾进行密文挪用。

# A.6.4 差错控制

在XTS模式中，在一个密文分组中的一个或多个比特差错只会影响发生差错的那一个分组的解密。

# A.6.5 同步

XTS模式不是自动同步的。如果加密和解密两个操作不同步，系统需要重新初始化。这种同步丢失可能由于插入或丢失任意数目的密文所引起。

每次重新初始化应使用一个新的调柄值，它不同于与同一个密钥一起使用的以前的调柄值。其原因是，相同的参数将产生相同的掩码序列，这将易于受到“已知明文攻击”。如果在密码实现中允许并行和流水线，XTS模式将易于受到“剪贴攻击”。

# A.7 带泛杂凑函数的计数器工作模式的性质

# A.7.1 场景

A.7 带泛杂凑函数的计数器工作模式的性质A.7.1 场景HCTR模式可以用于磁盘扇区加密等特殊的加密环境，其中调柄值用于表示扇区地址；只要使用同样的密钥和调柄对相同的明文进行加密，HCTR模式将产生相同的密文。HCTR模式也可用于一般的加密。该工作模式不适用于明文长度小于分组密码分组长度的情形。

# A.7.2 性质

HCTR的性质有：

A.7.2 性质HCTR的性质有：a) 除去第一个分组，HCTR支持并行加密和解密；b) HCTR模式对于不同的调柄值，得到在密钥控制下的不同置换；c) HCTR模式明文和密文长度相同，无论是加密和解密，任意输入数据的变化，都会带来所有输出比特的变化；d) HCTR模式具备可证明安全的理论保障。在底层分组密码算法具备超伪随机性质的情况下，HCTR模式被证明是超伪随机的，安全界是生日界。具体安全分析见参考文献[6]和参考文献[7]。

# A.7.3 填充明文

明文长度应不少于一个分组。数据经过泛杂凑函数处理时，需要填充。

# A.7.4 差错扩散

密文的任意比特的错误会导致明文每一个比特以  $50\%$  概率出现错误。

# A.7.5 同步

HCTR模式不是自动同步的。无论是进行加密还是解密，都是在输入完所有数据后，才能计算出输出结果。

# A.8 分组链接工作模式的性质

# A.8.1 场景

为了在分组链接模式中使用分组算法，可以简单地将分组密码算法的输入跟所有前面密文分组的异或值相异或。如CBC算法，过程要从一个初始向量IV开始。

只要使用同样的密钥和初始向量对相同的明文进行加密，BC工作模式将生成相同的密文。介意这种性质的用户需要采用某种方法来改变初始明文分组、密钥或初始向量。

# A.8.2 性质

BC工作模式的性质有：

a）链接操作使得密文分组依赖于当前的和以前的明文分组，因此对密文分组的重新排序不会导致对相应明文分组的重新排序；b）使用不同的IV从而防止同一明文加密成同一密文；c）BC模式的安全性证明见参考文献[8]。

# A.8.3 填充明文

只有长度为分组长度整数倍的明文才能被加密，其他长度的明文需要被填充至分组长度的整数倍。

# A.8.4 差错扩散

BC模式的反馈过程具有扩散明文错误的性质，这个问题是由于密文分组的解密依赖于所有前面的密文分组，密文中任一错误都将导致所有后续密文分组的解密出错。

# A.8.5 同步

如果解密或解密之间的分组边界丢失了（例如由于一个比特的滑动），则在重新建立正确的分组边界之前加密与解密之间将失去同步。如果分组边界丢失，所有解密操作的结果都是不正确的。

# A.9 带非线性函数的输出反馈工作模式的性质

# A.9.1 场景

带非线性函数的输出反馈是OFB和ECB的一个变体，它的密钥随每一个分组而改变。只要使用同样的密钥和初始向量对相同的明文进行加密，OFBNLF工作模式应将生成相同的密文。此外，当使用相同的密钥和IV时，OFBNLF工作模式将会生成相同的密钥流，因此，为了保密起见，对于一个给定的密钥，一个特定的IV只能使用一次。

# A.9.2 性质

OFBNLF的性质有：

A.9.2 性质OFBNLF 的性质有：a) 使用不同的  $IV$  值生成不同的密钥流，可防止同一明文加密成同一密文；b) OFBNLF 模式的加密和解密过程都使用分组密码的加密运算；c) OFBNLF 模式不依赖明文来生成用于对明文进行加密的密钥流；d) OFBNLF 模式的安全性证明见参考文献[9]。

# A.9.3 填充明文

只有长度为分组长度整数倍的明文才能被加密，其他长度的明文需要被填充至分组长度的整数倍。

# A.9.4 差错扩散

密文的一个比特错误将扩散到一个明文分组。如果一比特丢失或增加，那就有无限的错误扩散。

# A.9.5 同步

OFBNLF模式不是自动同步的。如果加密和解密两个操作不同步，系统需要重新初始化。这种同步丢失可能由于插入或丢失任意数目的密文所引起。

每次重新初始化应使用一个新的IV值，它不同于与同一个密钥一起使用的以前的IV值。其原因是对于相同的参数，每次都会生成相同的比特流，这将易于受到“已知明文攻击”。

附录B（资料性）工作模式示例

# B.1 概述

本附录举例说明使用本文件所规定的工作模式对消息的加密和解密，使用的分组密码是GB/T32907—2016中规定的SM4算法，见参考文献[10]。所有变量采用“左高右低”的方式标记，即变量最左侧为其最高位。

除XTS和HCTR之外，其他七种工作模式使用下列参数：

密码密钥为（十六进制）2B7E151628AED2A6ABF7158809CF4F3C。初始向量为（十六进制）000102030405060708090A0B0C0D0E0F。明文是（十六进制）6BC1BEE22E409F96E93D7E117393172AE2D8A571E03AC9C9EB76FAC45AF8E5130C81C46A35CE411E5FBC1191A0A52EFF69F2445DF4F9B17AD2B417BE66C3710。

B.7和B.8分别给出了XTS和HCTR所采用的参数。

# B.2 ECB工作模式

表B.1和表B.2分别给出ECB工作模式加密和解密的例子。

表B.1 ECB工作模式加密  

<table><tr><td>i</td><td>明文P</td><td>分组密码输入分组</td><td>分组密码输出分组</td><td>密文Ci</td></tr><tr><td>1</td><td>6BC1BEE22E409F96
E93D7E117393172A</td><td>6BC1BEE22E409F96
E93D7E117393172A</td><td>A51411FF04A71144
3891FCE7AB842A29</td><td>A51411FF04A71144
3891FCE7AB842A29</td></tr><tr><td>2</td><td>AE2D8A571E03AC9C
9EB76FAC45AF8E51</td><td>AE2D8A571E03AC9C
9EB76FAC45AF8E51</td><td>D5B50F46A9A730A0
F590FFA776D99855</td><td>D5B50F46A9A730A0
F590FFA776D99855</td></tr><tr><td>3</td><td>30C81C46A35CE411
E5FBC1191A0A52EF</td><td>30C81C46A35CE411
E5FBC1191A0A52EF</td><td>C9A86A4D71447F4E
873ADA4F388AF9B9</td><td>C9A86A4D71447F4E
873ADA4F388AF9B9</td></tr><tr><td>4</td><td>F69F2445DF4F9B17
AD2B417BE66C3710</td><td>F69F2445DF4F9B17
AD2B417BE66C3710</td><td>2B25557B50514D15
5939E6EC940AD90E</td><td>2B25557B50514D15
5939E6EC940AD90E</td></tr></table>

表B.2 ECB工作模式解密  

<table><tr><td>i</td><td>密文C</td><td>分组密码输入分组</td><td>分组密码输出分组</td><td>明文P</td></tr><tr><td>1</td><td>A51411FF04A71144
3891FCE7AB842A29</td><td>A51411FF04A71144
3891FCE7AB842A29</td><td>6BC1BEE22E409F96
E93D7E117393172A</td><td>6BC1BEE22E409F96
E93D7E117393172A</td></tr><tr><td>2</td><td>D5B50F46A9A730A0
F590FFA776D99855</td><td>D5B50F46A9A730A0
F590FFA776D99855</td><td>AE2D8A571E03AC9C
9EB76FAC45AF8E51</td><td>AE2D8A571E03AC9C
9EB76FAC45AF8E51</td></tr></table>

表B.2 ECB工作模式解密（续）  

<table><tr><td>i</td><td>密文C i</td><td>分组密码输入分组</td><td>分组密码输出分组</td><td>明文P i</td></tr><tr><td>3</td><td>C9A86A4D71447F4E 873ADA4F388AF9B9</td><td>C9A86A4D71447F4E 873ADA4F388AF9B9</td><td>30C81C46A35CE411 E5FBC1191A0A52EF</td><td>30C81C46A35CE411 E5FBC1191A0A52EF</td></tr><tr><td>4</td><td>2B25557B50514D15 5939E6EC940AD90E</td><td>2B25557B50514D15 5939E6EC940AD90E</td><td>F69F2445DF4F9B17 AD2B417BE66C3710</td><td>F69F2445DF4F9B17 AD2B417BE66C3710</td></tr></table>

# B.3 CBC工作模式

表B.3和表B.4分别给出CBC工作模式加密和解密的例子。

表B.3 CBC工作模式加密  

<table><tr><td>i</td><td>明文P i</td><td>分组密码输入分组</td><td>分组密码输出分组</td><td>密文C i</td></tr><tr><td>1</td><td>6BC1BEE22E409F96 E93D7E117393172A</td><td>6BC0BCE12A459991 E134741A7F9E1925</td><td>AC529AF989A62FCE 9CDDC5FFB84125CA</td><td>AC529AF989A62FCE 9CDDC5FFB84125CA</td></tr><tr><td>2</td><td>AE2D8A571E03AC9C 9EB76FAC45AE8E51</td><td>027F10AE97A58352 026AAA53FDEEA89B</td><td>B168DD69DB3COEEA 1AB16DE6AEA43C59</td><td>B168DD69DB3COEEA 1AB16DE6AEA43C59</td></tr><tr><td>3</td><td>30C81C46A35CE411 E5FBC1191A0A52EF</td><td>81A0C12F7860EAFB FF4AACFFB4AE6EB6</td><td>2C15567BFF8F7074 86C202C7BE59101F</td><td>2C15567BFF8F7074 86C202C7BE59101F</td></tr><tr><td>4</td><td>F69F2445DF4F9B17 AD2B417BE66C3710</td><td>DA8A723E20C0EB63 2BE943BC5835270F</td><td>74A629B350CDE7E11 BE99998AF5206D6C</td><td>74A629B350CDE7E11 BE99998AF5206D6C</td></tr></table>

表B.4CBC工作模式解密  

<table><tr><td>i</td><td>密文C i</td><td>分组密码输入分组</td><td>分组密码输出分组</td><td>明文P i</td></tr><tr><td>1</td><td>AC529AF989A62FCE 9CDDC5FFB84125CA</td><td>AC529AF989A62FCE 9CDDC5FFB84125CA</td><td>6BC0BCE12A459991 E134741A7F9E1925</td><td>6BC1BEE22E409F96 E93D7E117393172A</td></tr><tr><td>2</td><td>B168DD69DB3COEEA 1AB16DE6AEA43C59</td><td>B168DD69DB3COEEA 1AB16DE6AEA43C59</td><td>027F10AE97A58352 026AAA53FDEEA89B</td><td>AE2D8A571E03AC9C 9EB76FAC45AF8E51</td></tr><tr><td>3</td><td>2C15567BFF8F7074 86C202C7BE59101F</td><td>2C15567BFF8F7074 86C202C7BE59101F</td><td>81A0C12F7860EAFB FFAACACFFB4AE6EB6</td><td>30C81C46A35CE411 E5FBC1191A0A52EF</td></tr><tr><td>4</td><td>74A629B350CD7E11 BE99998AF5206D6C</td><td>74A629B350CD7E11 BE99998AF5206D6C</td><td>DA8A723E20C0EB63 2BE943BC5835270F</td><td>F69F2445DF4F9B17 AD2B417BE66C3710</td></tr></table>

# B.4 CFB工作模式

表B.5和表B.6分别给出CFB工作模式加密和解密的例子。此例所选的参数为： $j = k = 8$  且  $r = n$ 。 $k$  比特反馈以斜体形式给出。

表B.5 CFB工作模式加密  

<table><tr><td>i</td><td>明文P</td><td>分组密码输入分组</td><td>分组密码输出分组</td><td>密文Ci</td></tr><tr><td>1</td><td>6B</td><td>0001020304050607
08090A0B0C0D0E0F</td><td>D7B0B394034794B0
DF20D63A27C5496C</td><td>BC</td></tr><tr><td>2</td><td>C1</td><td>0102030405060708
090A0B0C0D0E0FBC</td><td>590B8185E6H10E0D
71838FDCD0706FF5</td><td>98</td></tr><tr><td>3</td><td>BE</td><td>0203040506070809
0A0B0C0D0E0FBC 98</td><td>08DB5E724D637170
C6C53D22CF9C2AAE</td><td>B6</td></tr><tr><td>4</td><td>E2</td><td>030405060708090A
0B0C0D0E0FBC98 B6</td><td>7E5370A265433064
1081E3FEB85AC871</td><td>9C</td></tr><tr><td>5</td><td>2E</td><td>0405060708090A0B
0C0D0E0FBC98B6 9C</td><td>25F88D7BA33C5A53
05E4F141B21BBFC6</td><td>0B</td></tr><tr><td>6</td><td>40</td><td>05060708090A0B0C
0D0E0FBC98B69C 0B</td><td>7A3705B7023A0A3B
5B628CA0DA4D6EE2</td><td>3A</td></tr><tr><td>7</td><td>9F</td><td>060708090A0B0C0D
0E0FBC98B69C0B 3A</td><td>572474E196F3C58B
6E8F8BE6B1712EBE</td><td>C8</td></tr><tr><td>8</td><td>96</td><td>0708090A0B0C0D0E
0FBC98B69C0B3A C8</td><td>EDDCA0DE36FF1E63
55D0D67DA339C723</td><td>7B</td></tr></table>

表B.6 CFB工作模式解密  

<table><tr><td>i</td><td>密文C</td><td>分组密码输入分组</td><td>分组密码输出分组</td><td>明文P</td></tr><tr><td>1</td><td>BC</td><td>0001020304050607
08090A0B0C0D0E0F</td><td>D7B0B394034794B0
DF20D63A27C5496C</td><td>6B</td></tr><tr><td>2</td><td>98</td><td>0102030405060708
090A0B0C0D0E0FBC</td><td>590B8185E6H10E0D
71838FDCD0706FF5</td><td>C1</td></tr><tr><td>3</td><td>B6</td><td>0203040506070809
0A0B0C0D0E0FBC 98</td><td>08DB5E724D637170
C6C53D22CF9C2AAE</td><td>BE</td></tr><tr><td>4</td><td>9C</td><td>030405060708090A
0B0C0D0E0FBC98 B6</td><td>7E5370A265433064
1081E3FEB85AC871</td><td>E2</td></tr><tr><td>5</td><td>0B</td><td>0405060708090A0B
0C0D0E0FBC98B6 9C</td><td>25F88D7BA33C5A53
05E4F141B21BBFC6</td><td>2E</td></tr><tr><td>6</td><td>3A</td><td>05060708090A0B0C
0D0E0FBC98B69C 0B</td><td>7A3705B7023A0A3B
5B628CA0DA4D6EE2</td><td>40</td></tr><tr><td>7</td><td>C8</td><td>060708090A0B0C0D
0E0FBC98B69C0B 3A</td><td>572474E196F3C58B
6E8F8BE6B1712EBE</td><td>9F</td></tr><tr><td>8</td><td>7B</td><td>0708090A0B0C0D0E
0FBC98B69C0B3A C8</td><td>EDDCA0DE36FF1E63
55D0D67DA339C723</td><td>96</td></tr></table>

# B.5 OFB工作模式

表B.7和表B.8分别给出OFB工作模式加密和解密的例子。此例所选的参数为：  $j = 128$  0

表B.7 OFB工作模式加密  

<table><tr><td>i</td><td>明文P i</td><td>分组密码输入分组</td><td>分组密码输出分组</td><td>密文C i</td></tr><tr><td>1</td><td>6BC1BEE22E409F96
E93D7E117393172A</td><td>0001020304050607
08090A0B0C0D0E0F</td><td>D7B0B394034704B0
DF20D63A27C5496C</td><td>BC710D762D070B26
361DA82B54565E46</td></tr><tr><td>2</td><td>AE2D8A571E03AC9C
9EB76FAC45AE8E51</td><td>D7B0B394034794B0
DF20D63A27C5496C</td><td>A98D4C7F2A77A64F
BABA4C3D604E9870</td><td>07A0C62834740AD3
240D239125E11621</td></tr><tr><td>3</td><td>30C81C46A35CE411
E5FBC1191A0A52EF</td><td>A98D4C7F2A77A64F
BABA4C3D604E9870</td><td>E4BEAE5A6AACAD40
158FDC37E3EAC677</td><td>D476B21CC9F04951
F0741D2EF9E09498</td></tr><tr><td>4</td><td>F69F2445DF4F9B17
AD2B417BE66C3710</td><td>E4BEAE5A6AACAD40
158FDC37E3EAC677</td><td>E31BD851F4BEA1B1
8B936EE69B6B1BDE</td><td>1584FC142BF13AA6
26B82F9D7D076CCE</td></tr></table>

表B.8 OFB工作模式解密  

<table><tr><td>i</td><td>密文C i</td><td>分组密码输入分组</td><td>分组密码输出分组</td><td>明文P i</td></tr><tr><td>1</td><td>BC710D762D070B26
361DA82B54565E46</td><td>0001020304050607
08090A0B0C0D0E0F</td><td>D7B0B394034704B0
DF20D63A27C5496C</td><td>6BC1BEE22E409F96
E93D7E117393172A</td></tr><tr><td>2</td><td>07A0C62834740AD3
240D239125E11621</td><td>D7B0B394034794B0
DF20D63A27C5496C</td><td>A98D4C7F2A77A64F
BABA4C3D604E9870</td><td>AE2D8A571E03AC9C
9EB76FAC45AF8E51</td></tr><tr><td>3</td><td>D476B21CC9F04951
F0741D2EF9E09498</td><td>A98D4C7F2A77A64F
BABA4C3D604E9870</td><td>E4BEAE5A6AACAD40
158FDC37E3EAC677</td><td>30C81C46A35CE411
E5FBC1191A0A52EF</td></tr><tr><td>4</td><td>1584FC142BF13AA6
26B82F9D7D076CCE</td><td>E4BEAE5A6AACAD40
158FDC37E3EAC677</td><td>E31BD851F4BEA1B1
8B936EE69B6B1BDE</td><td>F69F2445DF4F9B17
AD2B417BE66C3710</td></tr></table>

# B.6CTR工作模式

表B.9和表B.10分别给出CTR工作模式加密和解密的例子。此例所选的初始计数器为（十六进制)F0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF。

表B.9CTR工作模式加密  

<table><tr><td>i</td><td>明文P i</td><td>分组密码输入分组</td><td>分组密码输出分组</td><td>密文C i</td></tr><tr><td>1</td><td>6BC1BEE22E409F96
E93D7E117393172A</td><td>F0F1F2F3F4F5F6F7
F8F9FAFBCFDFDEFF</td><td>7F6FF490973AC58
FB2BB2C8EB7066EB</td><td>14AE4A72B97A93CE
1216CCD998E371C1</td></tr><tr><td>2</td><td>AE2D8A571E03AC9C
9EB76FAC45AE8E51</td><td>F0F1F2F3F4F5F6F7
F8F9FAFBCFDFDF00</td><td>CEDA65DC7D411F1
3F2E4AA9A053AFCA</td><td>60F7EF8B6344BD6D
A1992505E5FC219B</td></tr><tr><td>3</td><td>30C81C46A35CE411
E5FBC1191A0A52EF</td><td>F0F1F2F3F4F5F6F7
F8F9FAFBCFDFDF01</td><td>3B384BBECF019101
D9F487488675C008</td><td>0BF057F86C5D7510
3C0F46519C7FB2E7</td></tr><tr><td>4</td><td>F69F2445DF4F9B17
AD2B417BE66C3710</td><td>F0F1F2F3F4F5F6F7
F8F9FAFBCFDFDF02</td><td>DFB7214685940187
41C45528FBBBF81E</td><td>292805035ADB9A90
ECEF145359D7CF0E</td></tr></table>

表B.10CTR工作模式解密  

<table><tr><td>i</td><td>密文C</td><td>分组密码输入分组</td><td>分组密码输出分组</td><td>明文Pj</td></tr><tr><td>1</td><td>14AE4A72B97A50CE1216CCD998E371C1</td><td>F0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF</td><td>7F6FF490973A0C58FB2BB2C8EB7066EB</td><td>6BC1BEE22E409F96E93D7E117393172AE2D8A571E03AC9C9EB76FAC45AF8E51</td></tr><tr><td>2</td><td>60F7EF8B6344BD6DA1992505E5FC219B</td><td>F0F1F2F3F4F5F6F7F8F9FAFBFCFDFF00</td><td>CEDA63DC7A471FF13F2E4AA9A053AFCA</td><td>30C81C46A35CE411E5FBC1191A0A52EF</td></tr><tr><td>3</td><td>0BF057F86C8D75103C0F46519C7FB2E7</td><td>F0F1F2F3F4F5F6F7F8F9FAFBFCFDFF01</td><td>3B384BBECF519101D9F487488675E008</td><td>30C81C46A35CE411E5FBC1191A0A52EF</td></tr><tr><td>4</td><td>292805035ADB9A90ECEF145359D7CF0E</td><td>F0F1F2F3F4F5F6F7F8F9FAFBFCFDFF02</td><td>DFB721468504018741C45528BFBBF81E</td><td>F69F2445DF4F9B17AD2B417BE66C3710</td></tr></table>

# B.7 XTS工作模式

表B.11表B.12分别给出XTS工作模式加密和解密的例子。此例所选的参数为：密码密钥  $K_{1}$  为（十六进制）2B7E151628AED2A6ABF7158809CF4F3C。密码密钥  $K_{2}$  为（十六进制）000102030405060708090A0B0C0D0E0F。调柄值TW为（十六进制）F0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF。明文是（十六进制）6BC1BEE22E409F96E93D7E117393172AAE2D8A571E03AC9C9EB76FAC45AF8E5130C81C46A35CE411E5FBC1191A0A52EFF69F2445DF4F9B17。

表B.11 XTS工作模式加密  

<table><tr><td>i</td><td>明文P1</td><td>数据加密分组密码输入分组</td><td>数据加密分组密码输出分组</td><td>密文Ci</td></tr><tr><td>1</td><td>6BC1BEE22E409F96E93D7E117393172A</td><td>25BF97A0CF334C055FB2EEC510C64411</td><td>A72DAB13266EA3130D6BD8EB8C1C28EA</td><td>E9538251C71D7B80BBEE4483FEF497BD1</td></tr><tr><td>2</td><td>AE2D8A571E03AC9C9EB76FAC45AF8E51</td><td>68129EF66EBA455545F0A7C6740327CC</td><td>EA634CBAA69DC60CC54F5E25853CA646</td><td>2C5C581BD6242FC51E08964FB4F60FDB</td></tr><tr><td>3</td><td>30C81C46A35CE411E5FBC1191A0A52EF</td><td>B2D796161B0010F50858252C02DF0621</td><td>12246DA98247C09D3DEC08FAA0F564E2</td><td>0BA42F63499279213D318D2C11F6886E</td></tr><tr><td>4</td><td>F69F2445DF4F9B17</td><td>B790E16D8361E165A69E1ED5344A9A4B</td><td>4AABEA4B15BC03534BE07F369DC2209</td><td>903BE7F93A1B3479</td></tr></table>

表B.12 XTS工作模式解密  

<table><tr><td>i</td><td>密文C i</td><td>数据解密分组密码输入分组</td><td>数据解密分组密码输出分组</td><td>明文P i</td></tr><tr><td>1</td><td>E9538251C71DF80 BBE4483FEF497BD1</td><td>A72DAB13266EA813 0D6BD8EB8C1C28EA</td><td>25BF97A0CF334C05 5FB2EEC510C64411</td><td>6BC1BEE22E409F96 E93D7E117393172A</td></tr><tr><td>2</td><td>2C5C581BD624GFC5 1E08964FB4F69FDB</td><td>EA634CBAA69DC60C C54F5E25855CA646</td><td>68129EF66EBA4555 45F0A7C6740577CC</td><td>AE2D8A571E03AC9C 9EB76FAC45AF8E51</td></tr><tr><td>3</td><td>0BA42F6349927921 3D318D2C11F6886E</td><td>4AABEA4B15BC0353 4BE07F369D9C2209</td><td>B790E16D8361E165 A69E1ED5344AA9A4B</td><td>30C81C46A35CE411 E5FBC1191A0A52EF</td></tr><tr><td>4</td><td>903BE7F93A1B3479</td><td>12246DA98247C09D 3DEC08FAA0F564E2</td><td>B2D796161B0010F5 085252C02DF0621</td><td>F69F2445DF4F9B17</td></tr></table>

# B.8 HCTR工作模式

表B.13表B.14分别给出HCTR工作模式加密和解密的例子。此例所选的参数为：密码密钥  $K_{1}$  为（十六进制）2B7E151628AED2A6ABF7158809CF4F3C。密码密钥  $K_{2}$  为（十六进制）000102030405060708090A0B0C0D0E0F。调柄值TW为（十六进制）F0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF。明文是（十六进制）6BC11FE22E409F96E93D7E117393172AAE2DBA571E03AC9C9EB76FAC45AF8E5130C81C46A35CE411E5FBC1191A0A52EFF69F2445DF4F9B17AD2B417BE66C3710。

表B.13 HCTR工作模式加密  

<table><tr><td>i</td><td>明文P i</td><td>数据加密分组密码输入分组</td><td>数据加密分组密码输出分组</td><td>密文C i</td></tr><tr><td>1</td><td>6BC1BEE22E409F96 E93D7E117393172A</td><td>5FDF02BAD01068B8 09CB8E34AFCF2D5C</td><td>3D188488D62CF1F 5605FB1E137C4270</td><td>9CD7481D3B7CA904 B14B0484D9D4C83E</td></tr><tr><td>2</td><td>AE2D8A571E03AC9C 9EB76FAC45AF8E51</td><td>62C78632063C47A7 5FCE752ABCB36F2D</td><td>7DB326D90877D409 629D8E42888D8C27</td><td>D39EAC8E16747895 FC2AE1EECD220276</td></tr><tr><td>3</td><td>30C81C46A35CE411 E5FBC1191A0A52EF</td><td>62C78632063C47A7 5FCE752ABCB36F2E</td><td>9FF511698297DC16 B3E886D100DB3AFE</td><td>AF3DD02F21CB3807 561347C81AD13811</td></tr><tr><td>4</td><td>F69F2445DF4F9B17 AD2B417BE66C3710</td><td>62C78632063C47A7 5FCE752ABCB36F2F</td><td>8B477820F5B18DB3 D0EDCFC3626ABDF3</td><td>7DD85C652AFE16A4 7DC68EB884068AE3</td></tr></table>

表B.14 HCTR工作模式解密  

<table><tr><td>i</td><td>密文C</td><td>数据解密分组密码输入分组</td><td>数据解密分组密码输出分组</td><td>明文P i</td></tr><tr><td>1</td><td>9CD7481D3E7CA904
B14B4084D9D4C83E</td><td>3D188488D62C2F1F
5605FBI1E137C4270</td><td>5FDF02BAD01068B8
09CB8E34AFCF2D5C</td><td>6BC1BEE22E409F96
E93D7E117393172A</td></tr><tr><td>2</td><td>D39EAC8E16747895
FC2AE1EECD220276</td><td>62C78632063C47A7
5FCE752ABC36F2D</td><td>7DB326D908T7D409
629D8E42888DC8C27</td><td>AE2D8A571E03AC9C
9EB76FAC45AF8E51</td></tr><tr><td>3</td><td>AF3D0D2F21CB3807
561347C81AD13811</td><td>62C78632063C47A7
5FCE752ABC36F2E</td><td>9FF51169829FDC16
B3E886D100DB6AFE</td><td>30C81C46A35CE411
E5FBC1191A0A52EF</td></tr><tr><td>4</td><td>7DD85C652AFE16A4
7DC68EB884068AE3</td><td>62C78632063C47A7
5FCE752ABC36F2F</td><td>8B477820F5B18DB3
D0EDCFC3626ABDF3</td><td>F69F2445DF4F9B17
AD2B417BE66C3710</td></tr></table>

# B.9 BC工作模式

表B.15表B.16分别给出BC工作模式加密和解密的例子。

表B.15 BC工作模式加密  

<table><tr><td>i</td><td>明文P i</td><td>分组密码输入分组</td><td>分组密码输出分组</td><td>密文C i</td></tr><tr><td>1</td><td>6BC1BEE22E409F96
E93D7E117393172A</td><td>6BC0BCE12A459991
E134741AF79E1925</td><td>AC529AF989A62FCE
9CDDC5FFB84125CA</td><td>AC529AF989A62FCE
9CDDC5FFB84125CA</td></tr><tr><td>2</td><td>AE2D8A571E03AC9C
9EB76FAC45AF8E51</td><td>027E12AD93A08555
0A63A058F1E3A594</td><td>FB8CDE77339FFE48
1D113C40BBD5B678</td><td>FB8CDE77339FFE48
1D113C40BBD5B678</td></tr><tr><td>3</td><td>30C81C46A35CE411
E5FBC1191A0A52EF</td><td>67175ACB1D603390
6C3E32AD1593CF52</td><td>6FFC9916F989F94FF
12D78319707E2404</td><td>6FFC9916F989F94FF
12D78319707E2404</td></tr><tr><td>4</td><td>F69F2445DF4F9B17
AD2B417BE66C3710</td><td>CEBCFBDE98FCD869
363931D6998B8EA9</td><td>28718707605BC1EA
C503153EBAA0FBI1D</td><td>28718707605BC1EA
C503153EBAA0FBI1D</td></tr></table>

表B.16 BC工作模式解密  

<table><tr><td>i</td><td>密文C</td><td>分组密码输入分组</td><td>分组密码输出分组</td><td>明文P i</td></tr><tr><td>1</td><td>AC529AF989A62FCE
9CDDC5FFB84125CA</td><td>AC529AF989A62FCE
9CDDC5FFB84125CA</td><td>6BC0BCE12A459991
E134741AF79E1925</td><td>6BC1BEE22E409F96
E93D7E117393172A</td></tr><tr><td>2</td><td>FB8CDE77339FFE48
1D113C40BBD5B678</td><td>FB8CDE77339FFE48
1D113C40BBD5B678</td><td>027E12AD93A08555
0A63A058F1E3A594</td><td>AE2D8A571E03AC9C
9EB76FAC45AF8E51</td></tr><tr><td>3</td><td>6FFC9916F98F94FF
12D78319707E2404</td><td>6FFC9916F98F94FF
12D78319707E2404</td><td>67175ACB1D603390
6C3E32AD1593CF52</td><td>30C81C46A35CE411
E5FBC1191A0A52EF</td></tr><tr><td>4</td><td>28718707605BC1EA
C503153EBAA0FBI1D</td><td>28718707605BC1EA
C503153EBAA0FBI1D</td><td>CEBCFBDE98FCD869
363931D6998B8EA9</td><td>F69F2445DF4F9B17
AD2B417BE66C3710</td></tr></table>

# B.10 OFBNLF工作模式

表B.17表B.18分别给出OFBNLF工作模式加密和解密的例子。

表B.17 OFBNLF工作模式加密  

<table><tr><td>i</td><td>明文P i</td><td>K i</td><td>分组密码输出分组</td><td>密文C i</td></tr><tr><td>1</td><td>6BC1BEE2E409F96
E93D7E117393172A</td><td>D7B0B394034794B0
DF20D63A27C5496C</td><td>00A5B5C9E45557C
20CE7F267736F308</td><td>00A5B5C9E45557C
20CE7F267736F308</td></tr><tr><td>2</td><td>AE2D8A571E03AC9C
9EB76FAC45AF8E51</td><td>A98D4C7F2A77A64F
BABAA4C3D604E9870</td><td>A18037828850B9D7
8883CA622851F86C</td><td>A18037828850B9D7
8883CA622851F86C</td></tr><tr><td>3</td><td>30C81C46A35CE411
E5FBC1191A0A52EF</td><td>E4BEAE5A6AACAD40
158FDC37E3EAC677</td><td>B7CAEFDFB6D4CABA
6AE2D2FCE369CEB3</td><td>B7CAEFDFB6D4CABA
6AE2D2FCE369CEB3</td></tr><tr><td>4</td><td>F69F2445DF4F9B17
AD2B417BE66C3710</td><td>E31BD851F4BEA1B1
8B936EE69B6B5BDE</td><td>1001DD71FDDA9341
F8D221CB720FF27B</td><td>1001DD71FDDA9341
F8D221CB720FF27B</td></tr></table>

表B.18 OFBNLF工作模式解密  

<table><tr><td>i</td><td>密文C i</td><td>K i</td><td>分组密码输出分组</td><td>明文P i</td></tr><tr><td>1</td><td>00A5B5C9E45557C
20CETF207736F308</td><td>D7B0B394034794B0
DF20D63A27C5496C</td><td>6BC1BEE22E409F96
E5D9E117393172A</td><td>6BC1BEE22E409F96
E5D9E117393172A</td></tr><tr><td>2</td><td>A18037828850B9D7
8883CA622851F86C</td><td>A98D4C7F2A77A64F
BABAA4C3D604E9870</td><td>AE2D8A571E03AC9C
9EB76FAC45AF8E51</td><td>AE2D8A571E03AC9C
9EB76FAC45AF8E51</td></tr><tr><td>3</td><td>B7CAEFDFB6D4CABA
6AE2D2FCE369CEB3</td><td>E4BEAE5A6AACAD40
158FDC37E3EAC677</td><td>30C81C46A35CE411
E5FBC1191A0A52EF</td><td>30C81C46A35CE411
E5FBC1191A0A52EF</td></tr><tr><td>4</td><td>1001DD71FDDA9341
F8D221CB720FF27B</td><td>E31BD851F4BEA1B1
8B936EE69B6B5BDE</td><td>F69F2445DF4F9B17
AD2B417BE66C3710</td><td>F69F2445DF4F9B17
AD2B417BE66C3710</td></tr></table>

# 附录C（资料性）填充方法示例

# C.1 概述

当明文长度不满足工作模式所规定的分组长度的整数倍时，加解密操作方需要协商一个明文填充方法，满足以下性质：

a）对于任意长度的非空明文输入，能够输出满足工作模式规定的分组长度的明文分组序列；b）不同的非空明文输入无法输出相同的明文分组序列，即填充后的非空明文输入总是唯一的。需要注意的是，填充方法的选择将影响到工作模式的安全强度，有必要专门分析确定。

# C.2 填充方法1

以字节为基本单位，在明文字节串  $P$  的右侧填充a个字节“a”，其中“a”表示  $P$  的最后一个分组达到分组长度所需要的字节数。如果  $P$  为空串或其最后一个分组正好为分组长度，那么填充方法1规定在  $P$  右侧填充一个由b个字节“b”构成的分组，其中“b”表示一个明文分组所需要的字节数目。

例如：  $P$  为00112233445566778899，则填充之后为00112233445566778899060606060606；若  $P$  为00112233445566778899AABBCCDDEEFF，则填充之后为00112233445566778899AABBCCDDEEFF10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101

# C.3 填充方法2

在明文比特串  $P$  的右侧填充一个比特“1”，然后在所得到的比特串右侧填充“0”，尽可能少填充（甚至不填充），使填充后的比特串的长度是  $j$  的正整数倍。如果  $P$  是空串，那么填充方法2规定对其填充一个“1”，然后在其右侧填充  $j - 1$  个“0”。

例如：若  $j = 128,P$  为00112233445566778899，则填充之后为0011223344556677889980|Zero（40）；若  $P$  为00112233445566778899AABBCCDDEEFF，则填充之后为00112233445566778899AABBCCDDEEFF80|Zero（120）。

# C.4 填充方法3

在明文比特串  $P$  的右侧填充“0”，尽可能少填充（甚至不填充），使填充后比特串的长度是  $j$  的正整数倍。然后在所得到的明文比特串左侧填充一个分组  $L$  。分组  $L$  由尽可能少的“0”和明文比特串  $P$  的长度  $L_{P}$  的二进制表示组成，其中位于  $L_{P}$  二进制表示的左侧的“0”尽可能少，且使  $L$  的长度为  $j$  比特。  $L$  最右端的比特和  $L_{P}$  的二进制表示中的最低位相对应。如果是空串，那么填充方法3规定对其填充  $j$  个“0”，然后在其左侧填充一个由  $j$  个“0”组成的分组  $L$  。

例如：若  $j = 128,P$  为00112233445566778899，则填充之后为Zero（120）|0A00112233445566778899|Zero（48）；若  $P$  为00112233445566778899AABBCCDDEEFF，则填充之后为Zero（120）|1000112233445566778899AABBCCDDEEFF。

# 参考文献

[1] GB/T 1988 信息技术 信息交换用七位编码字符集[2] GB/T 15852.1 信息技术 安全技术 消息鉴别码 第1部分：采用分组密码的机制[3] GB/T 15852.3—2019 信息技术 安全技术 消息鉴别码 第3部分：采用泛杂凑函数的机制[4] GB/T 32907—2016 信息安全技术 SM4分组密码算法[5] GB/T 36624—2018 信息技术 安全技术 可鉴别的加密机制[6] ISO/IEC 10116:2017 Information technology—Security techniques—Modes of operation for an n- bit block cipher[7] IEEE 1619—2018 Standard for Cryptographic Protection of Data on Block- Oriented Storage Devices[8] 郑凯燕，王鹏. BC加密模式的分析及其改进[J]. 信息安全学报，2017（3）：61- 78. [9] Bellare M, Desai A, Jokipii E, Rogaway P.A Concrete Treatment of Symmetric Encryption. Proceedings of the 38th Annual Symposium on Foundations of Computer Science. pp.394- 403, IEEE, 1997. [10] Alkassar A, Geraldy A, Pfitzmann B, Sadeghi A. R.Optimized Self- Synchronizing Mode of Operation. Proceedings of Fast Software Encryption (FSE) 2001, Yokohama, Japan, Lecture Notes in Computer Science Vol.2355, pp.78- 91, Springer- Verlag, Berlin, 2001. [11] Rogaway P.: Efficient Instantiations of Tweakable Blockciphers and Refinements to Modes OCB and PMAC. ASIACRYPT 2004: 16- 31. [12] Ball, M.V., C.Guyot, J.P. Hughes, L. Martin, and L.C. Noll, “The XTS- AES Disk Encryption Algorithm and the Security of Ciphertext Stealing,” Cryptologia, vol.36, no.1, pp.70- 79, 2012. [13] Wang P., Feng D., Wu W.: HCTR A Variable- Input- Length Enciphering Mode. CISC 2005: 175- 188. [14] Debrup C., Mridul N.: An Improved Security Bound for HCTR. FSE 2008: 289- 302. [15] Sun Z., Wang P. Analysis of the OFBNLF encryption mode of operation, SCIENTIA SINICA Informationis, Volume 46, Issue 6: 729- 742(2016).